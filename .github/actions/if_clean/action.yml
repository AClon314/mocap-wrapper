name: "Check Disk and CleanupğŸ§¹"
description: "Check disk space and cleanup if low"
inputs:
  remainGB:
    description: "At least remain ? GB of disk space"
    required: false
    default: "7"
runs:
  using: "composite"
  steps:
    - name: Check disk space
      id: check_space
      run: |
        available=$(df / | tail -1 | awk '{print $4}')  # è·å–å¯ç”¨å—æ•°ï¼ˆ1K å—ï¼‰
        available_gb=$((available / 1024 / 1024))  # è½¬æ¢ä¸º GB
        threshold=${{ inputs.remainGB }}
        echo "if available=${available_gb}GB < threshold=${threshold}GB"
        if [ $available_gb -lt $threshold ]; then
          echo "low_space=true" >> $GITHUB_OUTPUT
          echo "ğŸ’¥ Low disk space!"
        else
          echo "low_space=false" >> $GITHUB_OUTPUT
          echo "âœ… Skip cleanup."
        fi
        df -h
      shell: bash

    - uses: rokibhasansagar/slimhub_actions@main
      if: steps.check_space.outputs.low_space == 'true'
      with:
        retain: "docker_buildkit"
